{"name":"Paypal-payments","tagline":"Accept and process payments with Paypal SDK","body":"# paypal payments\r\nAccept and process payments with Paypal REST Api\r\n\r\n### Introduction to Paypal payments plugin.\r\nThe Paypal payments plugin simplifies the integration of Paypal into Grails applications. With this plugin, you are not required to be a Paypal sdk guru in order to accept payments.\r\n\r\nThis guide documents how to use the paypal payments plugin to process payments for Grails Applications. \r\n\r\n### Getting Started\r\nI will assume that you already have your Grails application designed and ready to accept payments. A demo application will be sufficient for this exercise.  \r\n\r\n####Create a paypal account\r\nYou will need to create a paypal account and obtain API keys for a Paypal app. The Paypal app will represent your Grails application. To create a paypal app, please visit [https://developer.paypal.com/developer/applications/](Paypal developer page) to create a sandbox account. \r\n\r\nThe Sandbox account will allow you to play around with most of the API features available. It is also a good way to test your application integration before moving over to a live environment. \r\n\r\n####Obtain your client id and client secret\r\nObtain the API keys for your sandbox account/app and add it to your grails config file [Config.groovy for grails 2.x and application.groovy for grails 3.x]. Here's what my config file looks like: \r\n    paypal.email=\"omasiri@novadge.com\"\r\n    paypal.clientId = 'your client id'\r\n    paypal.sandbox.clientId = 'your client id'\r\n    paypal.clientSecret = 'your client secret'\r\n    paypal.sandbox.clientSecret ='your client secret'\r\n    paypal.endpoint = \"https://api.paypal.com\"\r\n    paypal.sandbox.endpoint = \"https://api.sandbox.paypal.com\"\r\n\r\n`\r\n\r\nNotice that I added config for sandbox and live environment. The reason is to be able to switch between both environments  during app development. \r\n\r\n####Create a grails controller and add required actions\r\nCreate a grails controller. Personally, I called my own controller PaypalController.\r\n\r\n\r\n`grails create-controller com.mypackage.Paypal\r\n`\r\n\r\n####Add required actions\r\n\r\nNormally, Paypal payments requires three steps to complete.\r\n1. Make approval request to paypal.\r\n2. Approval - Customer approves the payment\r\n3. Execution - Process response from Paypal in order to capture the payment.\r\n\r\n### Approval Step\r\n\r\nFor the approval step, here's my action inside my PaypalController . \r\nInject paypalService into your controller like this...\r\n\r\n`def paypalService`\r\n\r\n\r\nAnd then create your Controller action \r\n`\r\n    import com.paypal.base.Constants; \r\n\r\n    def approve(){\r\n       \r\n        \r\n        String clientId = grailsApplication.config.paypal.clientId\r\n        String clientSecret = grailsApplication.config.paypal.clientSecret\r\n        String endpoint = grailsApplication.config.paypal.endpoint\r\n        Map sdkConfig = [:] \r\n        sdkConfig.put(Constants.CLIENT_ID,clientId)\r\n        sdkConfig.put(Constants.CLIENT_SECRET,clientSecret)\r\n        sdkConfig.put(Constants.ENDPOINT,endpoint)\r\n        def accessToken = paypalService.getAccessToken(clientId,clientSecret,sdkConfig)\r\n        def apiContext = paypalService.getAPIContext(accessToken,sdkConfig)\r\n                  \r\n        def details = paypalService.createDetails(['subtotal':\"12.50\"])\r\n        def amount = paypalService.createAmount(['currency':currencyCode,'total':\"12.50\",'details':details])\r\n        \r\n        def transaction = paypalService.createTransaction(['amount':amount,'description':\"your description\",details:details])\r\n        def transactions = []\r\n        transactions.add(transaction)\r\n        \r\n        def payer = paypalService.createPayer(['paymentMethod':'paypal'])\r\n        def cancelUrl=\"http://myexampleurl/cancel\";\r\n        def returnUrl = \"http://mypaypalController/execute\";\r\n\r\n        def redirectUrls = paypalService.createRedirectUrls(['cancelUrl':cancelUrl,'returnUrl':returnUrl])\r\n\r\n  \r\n        def payment\r\n        try{\r\n            // create the paypal payment\r\n            payment = paypalService.createPayment(['payer':payer,'intent':'sale'\r\n                    ,'transactionList':transactions,'redirectUrls':redirectUrls\r\n                    ,'apiContext':apiContext])\r\n            \r\n\r\n\r\n        }\r\n        catch(Exception ex){\r\n            String msg = ex.getMessage()\r\n            flash.message = \"Could not complete the transaction because: ${msg? msg : ''}\"  \r\n            \r\n            redirect controller:'bill', action:\"show\",id:params['refId']\r\n            return\r\n        }\r\n       \r\n        def approvalUrl = \"\"\r\n        def retUrl = \"\"\r\n        // retrieve links from returned paypal object\r\n        payment?.links.each{ \r\n            if(it?.rel == 'approval_url'){\r\n                approvalUrl = it.href\r\n            }\r\n            if(it?.rel == 'return_url'){\r\n                retUrl = it.href\r\n\r\n            }\r\n        }\r\n\r\n\r\n        redirect url:approvalUrl? approvalUrl:'/', method:'POST'\r\n\r\n    }\r\n`\r\n\r\n\r\n### Approval\r\nThe customer will be redirected to the Paypal website for approval. After the customer approves or \r\ncancels the payment, Paypal will either call the returnUrl or cancelUrl you provided depending on \r\nwhat action the customer performs. \r\n\r\n    def execute(){\r\n        \r\n        String clientId = grailsApplication.config.paypal.clientId\r\n        String clientSecret = grailsApplication.config.paypal.clientSecret\r\n        String endpoint = grailsApplication.config.paypal.endpoint\r\n        Map sdkConfig = [:] //= grailsApplication.config.paypal.sdkConfig//['mode':'live']\r\n        //sdkConfig.put(\"grant-type\",\"client_credentials\")\r\n        sdkConfig.put(Constants.CLIENT_ID,clientId)\r\n        sdkConfig.put(Constants.CLIENT_SECRET,clientSecret)\r\n        sdkConfig.put(Constants.ENDPOINT,endpoint)\r\n        def accessToken = paypalService.getAccessToken(clientId,clientSecret,sdkConfig)\r\n        def apiContext = paypalService.getAPIContext(accessToken,sdkConfig)\r\n        //the paypal website will add params to the call to your app. Eg. PayerId, PaymentId\r\n        // you will use the params to 'execute' the payment\r\n        def paypalPayment = paypalService.createPaymentExecution(['paymentId':params.paymentId,'payerId':params?.PayerID],apiContext)\r\n        \r\n        JsonSlurper slurper = new JsonSlurper()\r\n        def map = slurper.parseText(paypalPayment.toString())\r\n\r\n        redirect(url:\"to your url\")\r\n    }\r\n\r\n### Other things you can do\r\nYou may perform payouts and other kinds of paypal transactions with this plugin. \r\n\r\n### Authors and Contributors\r\nOmasirichukwu Joseph Udeinya (@omasiri) \r\n\r\n### Support or Contact\r\nPlease feel free to reach out to us for assistance with this plugin and weâ€™ll help you sort it out.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}